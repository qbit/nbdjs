From 517d7dacf4dd984b36f0b06f6e1f999dd1b4b885 Mon Sep 17 00:00:00 2001
From: Rasmus Andersson <rasmus@notion.se>
Date: Wed, 7 Jul 2010 21:43:07 +0200
Subject: [PATCH 1/2] Added new option "secure" to the IRC client, enabling SSL connections (verified or unverified)

---
 API.md     |    3 +++
 lib/irc.js |    8 ++++++++
 2 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/API.md b/API.md
index 0228b48..cb5d766 100644
--- a/API.md
+++ b/API.md
@@ -21,8 +21,11 @@ values:
         showErrors: false,
         autoRejoin: true,
         channels: [],
+        secure: false
     }
 
+`secure` (SSL connection) can be a true value or an object (the kind of object returned from `crypto.createCredentials()`) specifying cert etc for validation.
+
 `irc.Client` instances are an EventEmitters with the following events:
 
 ### Event: 'motd'
diff --git a/lib/irc.js b/lib/irc.js
index 4e6b831..dd5b29a 100644
--- a/lib/irc.js
+++ b/lib/irc.js
@@ -512,6 +512,7 @@ function Client(server, nick, opt) {
         channels: [],
         retryCount: null,
         retryDelay: 2000,
+        secure: false,
     };
 
     if (typeof arguments[2] == 'object') {
@@ -708,6 +709,13 @@ Client.prototype.connect = function ( retryCount ) { // {{{
     var self = this;
     self.chans = {};
     self.conn = net.createConnection(self.opt.port, self.opt.server);
+    if (self.opt.secure) {
+      if (typeof self.opt.secure !== 'object') {
+        // Will not verify the client upon ssl handshake
+        self.opt.secure = require('crypto').createCredentials({});
+      }
+      self.conn.setSecure(self.opt.secure);
+    }
     self.conn.setTimeout(0);
     self.conn.setEncoding('utf8');
     self.conn.addListener("connect", function () {
-- 
1.7.0.4
